###
# created by python script convert.py
# Felix Sterzelmaier, Concat AG
# Created: 2019-11-12 11:23:02 CET(+0100)
# Dependencies: pip install --upgrade pip
# Dependencies: pip install pyvmomi
# Dependencies: pip3.6 install --upgrade pip
# Dependencies: /usr/local/bin/pip3.6 install pyvmomi
# Test with: ansible-playbook (filename) --connection=local --check
# Run with: ansible-playbook (filename) --connection=local
# OR run with Python 2.7.5: ansible-playbook (filename) --connection=local -e 'ansible_python_interpreter=/usr/bin/python2'
# OR run with Python 2.7.16: ansible-playbook (filename) --connection=local -e 'ansible_python_interpreter=/usr/bin/python2.7'
# OR run with Python 3.6.8: ansible-playbook (filename) --connection=local -e 'ansible_python_interpreter=/usr/bin/python3'
# Run on: 10.10.5.239 as user ansible in path /home/ansible/
# Before reading this playbook please read the sourcecode of convert.py first!
###
---
- hosts: localhost
  vars:
    config: "A_oneview_config.json"
  tasks:

#---------------------------- Logical Interconnect Group lig_sas
     - name: Create logical Interconnect Group lig_sas
       oneview_sas_logical_interconnect_group:
         config: "{{ config }}"
         state: present
         data:
             name:                   "lig_sas"
             enclosureType:          "SY12000"
             redundancyType:         ""
             type:                   "sas-logical-interconnect-groupV2"
             interconnectBaySet:     1
             enclosureIndexes:
                 - 1
             interconnectMapTemplate:
                 interconnectMapEntryTemplates:
                     - permittedInterconnectTypeUri: "/rest/sas-interconnect-types/Synergy12GbSASConnectionModule"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    4
                               type:             "Bay" 
                             - relativeValue:    1
                               type:             "Enclosure" 
                     - permittedInterconnectTypeUri: "/rest/sas-interconnect-types/Synergy12GbSASConnectionModule"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Bay" 
                             - relativeValue:    1
                               type:             "Enclosure" 
       delegate_to: localhost
 
#---------------------------- Logical Interconnect Group lig_vc
     - name: Get uri for network ei-1300-48
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "ei-1300-48"
     - set_fact:         var_ei_1300_48="{{ethernet_networks.uri}}"

     - name: Get uri for network ib-mgmt
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "ib-mgmt"
     - set_fact:         var_ib_mgmt="{{ethernet_networks.uri}}"

     - name: Get uri for network iSCSI-A
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-A"
     - set_fact:         var_iscsi_a="{{ethernet_networks.uri}}"

     - name: Get uri for network iSCSI-B
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-B"
     - set_fact:         var_iscsi_b="{{ethernet_networks.uri}}"

     - name: Get uri for network iSCSI-Deployment
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-Deployment"
     - set_fact:         var_iscsi_deployment="{{ethernet_networks.uri}}"

     - name: Get uri for network prod-1000-0
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "prod-1000-0"
     - set_fact:         var_prod_1000_0="{{ethernet_networks.uri}}"

     - name: Get uri for network prt-1100-16
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "prt-1100-16"
     - set_fact:         var_prt_1100_16="{{ethernet_networks.uri}}"

     - name: Get uri for network tst-1200-32
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "tst-1200-32"
     - set_fact:         var_tst_1200_32="{{ethernet_networks.uri}}"

     - name: Get uri for network vSphereFT
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "vSphereFT"
     - set_fact:         var_vsphereft="{{ethernet_networks.uri}}"

     - name: Get uri for network vSphereVMotion
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "vSphereVMotion"
     - set_fact:         var_vspherevmotion="{{ethernet_networks.uri}}"

     - name: Get uri for network oob-mgmt
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "oob-mgmt"
     - set_fact:         var_oob_mgmt="{{ethernet_networks.uri}}"

     - name: Create logical Interconnect Group lig_vc
       oneview_logical_interconnect_group:
         config: "{{ config }}"
         state: present
         data:
             name:                   "lig_vc"
             enclosureType:          "SY12000"
             type:                   "logical-interconnect-groupV6"
             redundancyType:         "HighlyAvailable"
             interconnectBaySet:     3
             ethernetSettings:           
                 type:                           "EthernetInterconnectSettingsV5"
                 enableIgmpSnooping:             false
                 igmpIdleTimeoutInterval:        260
                 enableNetworkLoopProtection:    true
                 enablePauseFloodProtection:     true
                 enableRichTLV:                  false
                 enableTaggedLldp:               true
                 enableStormControl:             false
                 stormControlThreshold:          0
                 enableFastMacCacheFailover:     true
                 macRefreshInterval:             5
             enclosureIndexes:
                 - 1
                 - 2
                 - 3
             interconnectMapTemplate:
                 interconnectMapEntryTemplates:
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "2"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    3
                               type:             "Bay" 
                             - relativeValue:    2
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "3"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    6
                               type:             "Bay" 
                             - relativeValue:    3
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "3"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    3
                               type:             "Bay" 
                             - relativeValue:    3
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Enclosure" 
                             - relativeValue:    6
                               type:             "Bay" 
                     - permittedInterconnectTypeName: "Virtual Connect SE 40Gb F8 Module for Synergy"
                       enclosureIndex:               "2"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    6
                               type:             "Bay" 
                             - relativeValue:    2
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Virtual Connect SE 40Gb F8 Module for Synergy"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Enclosure" 
                             - relativeValue:    3
                               type:             "Bay" 
             internalNetworkUris:
                - "{{var_vsphereft}}"    # networkName: vSphereFT 
             uplinkSets:
                 - name:                  "iSCSI-Deployment"
                   networkType:           "Ethernet"
                   ethernetNetworkType:   "ImageStreamer"
                   mode:                  "Auto"
                   networkUris:
                         - "{{var_iscsi_deployment}}"    # networkName: iSCSI-Deployment 
                   logicalPortConfigInfos:
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 63
                               type: "Port" 
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 62
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 62
                               type: "Port" 
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 63
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                 - name:             "Uplink_Prod"
                   networkType:      "Ethernet"
                   mode:             "Auto"
                   lacpTimer:        "Long"
                   networkUris:
                         - "{{var_ei_1300_48}}"    # networkName: ei-1300-48 
                         - "{{var_ib_mgmt}}"    # networkName: ib-mgmt 
                         - "{{var_iscsi_a}}"    # networkName: iSCSI-A 
                         - "{{var_iscsi_b}}"    # networkName: iSCSI-B 
                         - "{{var_prod_1000_0}}"    # networkName: prod-1000-0 
                         - "{{var_prt_1100_16}}"    # networkName: prt-1100-16 
                         - "{{var_tst_1200_32}}"    # networkName: tst-1200-32 
                         - "{{var_vspherevmotion}}"    # networkName: vSphereVMotion 
                   logicalPortConfigInfos:
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                             - relativeValue: 71
                               type: "Port" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 3
                               type: "Bay" 
                             - relativeValue: 71
                               type: "Port" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 66
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 66
                               type: "Port" 
                             - relativeValue: 2
                               type: "Enclosure" 
       delegate_to: localhost

