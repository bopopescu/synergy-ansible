###
# Copyright (2016-2017) Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License");
# You may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
###
---
- hosts: all
  vars:
    config: "{{ playbook_dir }}/oneview_config.json"
    deployment_plan_name: "nublarEsxiUpdated"
    golden_image_name: "NublarEsxiUpdated_GI" #CODE aus checkliste:Synergy-MGMT:33 ohne zip
  tasks:
    - name: Retrieve GoldenImage URI
      image_streamer_golden_image_facts:
        config: "{{ config }}"
        name: "{{ golden_image_name }}"
      register: result

    - name: Create a Deployment Plan
      image_streamer_deployment_plan:
        config: "{{ config }}"
        state: present
        data:
          description: "Release Build mit SUT und NCM"
          name: '{{ deployment_plan_name }}'
          hpProvided: 'false'
          oeBuildPlanName: "HPE - ESXi 6.7 - deploy with multiple management NIC HA config - 2019-07-24"
          goldenImageURI: "{{ golden_images[0].uri }}"
          type: "OEDeploymentPlanV5"
          customAttributes:
            - name: ManagementNIC
              constraints: "{\"ipv4static\":true,\"ipv4dhcp\":true,\"ipv4disable\":false,\"parameters\":[\"dns1\",\"dns2\",\"gateway\",\"ipaddress\",\"mac\",\"netmask\",\"vlanid\"]}"
              description: "Configuring first NIC for Teaming in ESXi"
              editable: true
              id: "edc74bf8-d469-470f-a3e2-107e5c45e750"
              type: nic
              value: null
              visible: true
            - name: DomainName
              constraints: "{\"helpText\":\"\"}"
              description: "Fully Qualified Domain Name for ESXi host"
              editable: true
              id: "55704650-ce70-4f45-85f1-f3ff4dfeaf04"
              type: fqdn
              value: "ad.nublar.de"
              visible: true
            - name: SSH
              constraints: "{\"options\":[\"enabled\",\"disabled\"]}"
              description: "To enable/disable and start/stop SSH in ESXi"
              editable: true
              id: "99c9c40d-1f83-48a2-9367-1028ed55513f"
              type: option
              value: enabled
              visible: true
            - name: Hostname
              constraints: "{\"helpText\":\"\"}"
              description: "Hostname for VMware ESXi host. The hostname value can be defined manually or by using the tokens. This value must conform to valid hostname requirement defined by Internet standards."
              editable: true
              id: "8b11e853-e49a-49f0-9a0d-fbd80805758f"
              type: hostname
              value: ""
              visible: true
            - name: ManagementNIC2
              constraints: "{\"ipv4static\":true,\"ipv4dhcp\":false,\"ipv4disable\":false,\"parameters\":[\"mac\",\"vlanid\"]}"
              description: "Configuring second NIC for Teaming in ESXi"
              editable: true
              id: "46c75ab3-6da7-4a2b-a575-ef18dab2d458"
              type: nic
              value: null
              visible: true
            - name: Password
              constraints: "{\"options\":[\"\"]}"
              description: "Password value must meet password complexity and minimum length requirements defined for ESXi 5.x, ESXi 6.x appropriately."
              editable: true
              id: "e6709ead-e111-4b3e-8039-0cc97f2c0120"
              type: password
              value: ""
              visible: true


