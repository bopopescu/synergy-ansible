###
# Copyright (2016-2017) Hewlett Packard Enterprise Development LP
#
# Licensed under the Apache License, Version 2.0 (the "License");
# You may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
###
---
- hosts: localhost
  vars:
    config: "oneview_config.json"
  tasks:

#---------------------------- Logical Interconnect Group lig_sas
     - name: Create logical Interconnect Group lig_sas
       oneview_sas_logical_interconnect_group:
         config: "{{ config }}"
         state: present
         data:
             name:                   "lig_sas"
             enclosureType:          "SY12000"
             redundancyType:         ""
             interconnectBaySet:     1
             enclosureIndexes:
                 - 1
             interconnectMapTemplate:
                 interconnectMapEntryTemplates:
                     - permittedInterconnectTypeUri: "/rest/sas-interconnect-types/Synergy12GbSASConnectionModule"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    4
                               type:             "Bay" 
                             - relativeValue:    1
                               type:             "Enclosure" 
                     - permittedInterconnectTypeUri: "/rest/sas-interconnect-types/Synergy12GbSASConnectionModule"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Bay" 
                             - relativeValue:    1
                               type:             "Enclosure" 
       delegate_to: localhost
 
#---------------------------- Logical Interconnect Group lig_vc
     - name: Get uri for network vSphereFT
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "vSphereFT"
     - set_fact:         var_vSphereFT="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network iSCSI-Deployment
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-Deployment"
     - set_fact:         var_iSCSI_Deployment="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network tst-1200-32
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "tst-1200-32"
     - set_fact:         var_tst_1200_32="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network iSCSI-A
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-A"
     - set_fact:         var_iSCSI_A="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network iSCSI-B
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "iSCSI-B"
     - set_fact:         var_iSCSI_B="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network ei-1300-48
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "ei-1300-48"
     - set_fact:         var_ei_1300_48="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network vSphereVMotion
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "vSphereVMotion"
     - set_fact:         var_vSphereVMotion="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network ib-mgmt
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "ib-mgmt"
     - set_fact:         var_ib_mgmt="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network prod-1000-0
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "prod-1000-0"
     - set_fact:         var_prod_1000_0="{{ethernet_networks[0].uri}}"
 
     - name: Get uri for network prt-1100-16
       oneview_ethernet_network_facts:
         config:         "{{ config }}"
         name:           "prt-1100-16"
     - set_fact:         var_prt_1100_16="{{ethernet_networks[0].uri}}"
 
     - name: Create logical Interconnect Group lig_vc
       oneview_logical_interconnect_group:
         config: "{{ config }}"
         state: present
         data:
             name:                   "lig_vc"
             enclosureType:          "SY12000"
             redundancyType:         "HighlyAvailable"
             interconnectBaySet:     3
             ethernetSettings:           
                 type:                           "EthernetInterconnectSettingsV4"
                 enableIgmpSnooping:             false
                 igmpIdleTimeoutInterval:        260
                 enableNetworkLoopProtection:    true
                 enablePauseFloodProtection:     true
                 enableRichTLV:                  false
                 enableTaggedLldp:               true
                 enableStormControl:             false
                 stormControlThreshold:          0
                 enableFastMacCacheFailover:     true
                 macRefreshInterval:             5
             enclosureIndexes:
                 - 1
                 - 2
                 - 3
             interconnectMapTemplate:
                 interconnectMapEntryTemplates:
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "2"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    3
                               type:             "Bay" 
                             - relativeValue:    2
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "3"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    6
                               type:             "Bay" 
                             - relativeValue:    3
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "3"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    3
                               type:             "Bay" 
                             - relativeValue:    3
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Synergy 20Gb Interconnect Link Module"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Enclosure" 
                             - relativeValue:    6
                               type:             "Bay" 
                     - permittedInterconnectTypeName: "Virtual Connect SE 40Gb F8 Module for Synergy"
                       enclosureIndex:               "2"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    6
                               type:             "Bay" 
                             - relativeValue:    2
                               type:             "Enclosure" 
                     - permittedInterconnectTypeName: "Virtual Connect SE 40Gb F8 Module for Synergy"
                       enclosureIndex:               "1"
                       logicalLocation: 
                         locationEntries: 
                             - relativeValue:    1
                               type:             "Enclosure" 
                             - relativeValue:    3
                               type:             "Bay" 
             internalNetworkUris:
                - "{{var_vSphereFT}}"    # networkName: vSphereFT 
             uplinkSets:
                 - name:             "iSCSI-Deployment"
                   networkType:      "Ethernet"
                   mode:             "Auto"
                   networkUris:
                         - "{{var_iSCSI_Deployment}}"    # networkName: iSCSI-Deployment 
                   logicalPortConfigInfos:
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 63
                               type: "Port" 
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 62
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 62
                               type: "Port" 
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 63
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                 - name:             "Uplink_Prod"
                   networkType:      "Ethernet"
                   mode:             "Auto"
                   networkUris:
                         - "{{var_tst_1200_32}}"    # networkName: tst-1200-32 
                         - "{{var_iSCSI_A}}"    # networkName: iSCSI-A 
                         - "{{var_iSCSI_B}}"    # networkName: iSCSI-B 
                         - "{{var_ei_1300_48}}"    # networkName: ei-1300-48 
                         - "{{var_vSphereVMotion}}"    # networkName: vSphereVMotion 
                         - "{{var_ib_mgmt}}"    # networkName: ib-mgmt 
                         - "{{var_prod_1000_0}}"    # networkName: prod-1000-0 
                         - "{{var_prt_1100_16}}"    # networkName: prt-1100-16 
                   logicalPortConfigInfos:
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 2
                               type: "Enclosure" 
                             - relativeValue: 71
                               type: "Port" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 3
                               type: "Bay" 
                             - relativeValue: 71
                               type: "Port" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 1
                               type: "Enclosure" 
                             - relativeValue: 66
                               type: "Port" 
                             - relativeValue: 3
                               type: "Bay" 
                     - desiredSpeed: "Auto"
                       logicalLocation:
                         locationEntries:
                             - relativeValue: 6
                               type: "Bay" 
                             - relativeValue: 66
                               type: "Port" 
                             - relativeValue: 2
                               type: "Enclosure" 
       delegate_to: localhost
 
